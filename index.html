<!DOCTYPE html>
<html>
    <head>
    	<title>Leaflet motion plugin</title>
    	<meta charset="utf-8" />

    	<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"/>
		<link rel="stylesheet" href="https://leaflet.github.io/Leaflet.draw/src/leaflet.draw.css"/>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
        <style>
            html, body, #map { width: 100%; height: 100%; margin: 0px; padding: 0px;}
			.leaflet-div-icon {
				background: transparent!important;
				border: none!important;
				color: white;
			}
        </style>
     </head>

    <body>

		<script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet-src.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js"></script>

		<script src="src/leaflet.motion.js"></script>
		<script src="src/leaflet.motion.easing.js"></script>
		<script src="src/layer/leaflet.motion.polyline.js"></script>
		<script src="src/layer/leaflet.motion.polygon.js"></script>
		<script src="src/layer/leaflet.motion.group.js"></script>
		<script src="src/layer/leaflet.motion.seq.js"></script>
		<script src="src/leaflet.motion.move.js"></script>
		<script src="src/leaflet.motion.utils.js"></script>
		<div id="map"></div>
    	<script>
			var map = L.map("map").setView([51, 1], 8);

			L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
				attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
			}).addTo(map);

			var options = {
		        draw: {
		            polygon: false,
		            circle: false, // Turns off this drawing tool
		            rectangle: false,
		            marker: false,
					circlemarker: false
		        }
		    };

			var drawControl = new L.Control.Draw(options);
		    map.addControl(drawControl);

		    map.on(L.Draw.Event.CREATED, function (e) {
		        var type = e.layerType,
		            layer = e.layer;

		        if (type === 'marker') {
		            layer.bindPopup('A popup!');
		        }

				if (type === "polyline") {
					L.motion.polyline(L.motion.move.durationMove(layer.getLatLngs(), 5000), {
						color: "orange",
						auto: true
					}).addTo(map);
				}

				if (type === "polygon") {
					L.motion.polygon(layer.getLatLngs(), {
						color: "red",
						auto: true
					}).addTo(map);
				}

				//map.addLayer(layer);
		    });

			var greenLine = [[51,3], [51,1]];
			var motionGroup = L.motion.group(
					[L.motion.move.durationMove([[52,1], [51,1]], 5000, {
						color: "transparent",
						dashArray: "10 5 5",
						markerOptions: {}
					}),
					L.motion.move.durationMove([[52,3], [51,3]], 3000, {
						color: "red",
						markerOptions: {
							icon: L.divIcon({html: "<i class='fa fa-car fa-2x' aria-hidden='true'></i>", iconSize: L.point(27.5, 24)})
						}
					}),
					L.motion.move.durationMove([[52,2], [51,2]], L.Motion.Animate.getDuration(greenLine, 30), {
						color: "white",
						dashArray: "10 5 5",
						motionMarkerOnLine: -45, // To position it north
						markerOptions: {
							icon: L.divIcon({html: "<i class='fa fa-plug fa-2x' aria-hidden='true'></i>", iconSize: L.point(24, 24)})
						}
					})
				]
			).addTo(map);

			setTimeout(function(){
				motionGroup.startMotion();
			}, 1000);

			motionGroup.on("click", function(){
				motionGroup.toggleMotion();
			});

			var duration = 3000; // in ms === 3s
			var options = {
				color: "white",
				removeMarkerOnEnd: true,
				markerOptions: {
					icon: L.divIcon({html: "<i class='fa fa-snowflake-o fa-spin fa-2x' aria-hidden='true'></i>", iconSize: L.point(22, 24)})
				}
			};

			var seqGroup = L.motion.seq(L.motion.move.durationMove([[50,0], [51,0]], duration, options))
									.nextMotion(L.motion.move.durationMove([[51,0], [51,1]], duration, options))
									.nextMotion(L.motion.move.durationMove([[51,1], [50,1]], duration, options))
									.nextMotion(L.motion.move.durationMove([[50,1], [50,0]], duration, options)).addTo(map).startMotion();
    	</script>
    </body>

</html>
